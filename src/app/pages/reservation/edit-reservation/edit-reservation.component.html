<div [style.margin.px]="40">
  <div tuiGroup class="group tui-row tui-space_top-5">
    <button tuiButton type="button" [appearance]="status === 0 ? 'primary' : 'outline'" size="l" (click)="setStatus(0)">
      Ожидание клиента
    </button>
    <button tuiButton type="button" [appearance]="status === 1 ? 'primary' : 'outline'" size="l" (click)="setStatus(1)">
      Клиент пришел
    </button>
    <button tuiButton type="button" [appearance]="status === 2 ? 'primary' : 'outline'" size="l" (click)="setStatus(2)">
      Клиент не пришел
    </button>
    <button tuiButton type="button" [appearance]="status === 3 ? 'primary' : 'outline'" size="l" (click)="setStatus(3)">
      Услуга оказана
    </button>
  </div>

  <tui-island class="tui-row tui-space_top-5 tui-space_bottom-5">
    <h3 class="tui-island__title">Клиент:</h3>
    <p class="tui-island__paragraph">Имя: {{ client.name }}</p>
    <p class="tui-island__paragraph">Телефон: {{ client.phone }}</p>
    <p class="tui-island__paragraph">Email: {{ client.email }}</p>
    <tui-combo-box
      *ngIf="replaceClient"
      class="b-form tui-form__row"
      [stringify]="clientStringify"
      [(ngModel)]="newClient"
      (searchChange)="searchClient$.next($event)">
      Поиск клиента
      <input
        tuiTextfield
        placeholder="Поиск по имени/телефону"
        (input)="searchClient$.next(extractValueFromEvent($event))" />
      <tui-data-list-wrapper
        *tuiDataList
        [itemContent]="clientStringify | tuiStringifyContent"
        [items]="clients$ | async"></tui-data-list-wrapper>
    </tui-combo-box>
    <button
      tuiButton
      type="button"
      [appearance]="replaceClient ? 'accent' : 'flat'"
      size="m"
      class="tui-island__footer-button"
      (click)="replaceClient = !replaceClient">
      {{ replaceClient ? 'отмена' : 'Замена клиента' }}
    </button>
  </tui-island>

  <tui-island class="tui-row">
    <h3 class="tui-form__header tui-form__header_margin-top_none tui-form__row">Список услуг</h3>
    <p class="tui-island__paragraph">Стоимость: <tui-money [value]="purchaseAmount"></tui-money></p>
    <p class="tui-island__paragraph">Время: {{ durationAmount }} мин.</p>
    <div tuiGroup class="tui-form__row" *ngFor="let service of services; index as idx">
      <tui-combo-box
        *tuiLet="listServices$ | async as listServices"
        class="b-form"
        [(ngModel)]="services[idx]"
        [stringify]="serviceStringify"
        (ngModelChange)="changeServices(idx)">
        Поиск услуги
        <input tuiTextfield placeholder="Поиск по названию" />
        <tui-data-list-wrapper
          *tuiDataList
          [itemContent]="serviceStringify | tuiStringifyContent"
          [items]="listServices | tuiFilterByInputWith : serviceStringify"></tui-data-list-wrapper>
      </tui-combo-box>
      <button
        tuiIconButton
        type="button"
        appearance="outline"
        size="l"
        (click)="removeService(idx)"
        icon="tuiIconCloseLarge"
        class="tui-group__auto-width-item"></button>
    </div>
    <button tuiButton type="button" appearance="flat" size="m" (click)="addService()" class="tui-island__footer-button">
      Добавить услугу
    </button>
  </tui-island>

  <div class="flex-wrap tui-form__row">
    <button tuiButton class="tui-form__button left" (click)="showDialog()">Перенести запись</button>
    <button tuiButton class="tui-form__button left" (click)="save()">Сохранить</button>
    <button tuiButton class="tui-form__button right" appearance="accent" (click)="removeOrder()">Удалить запись</button>
  </div>
</div>

<ng-template let-observer [tuiDialogOptions]="{ label: 'Перезапись', size: 's' }" [(tuiDialog)]="open">
  <tui-input-date class="tui-form__row" [(ngModel)]="day" (ngModelChange)="searchTimes()" [min]="minDay" [max]="maxDay">
    Choose a date
  </tui-input-date>
  <tui-input-time class="tui-form__row" [items]="timesTest" [(ngModel)]="time"> Input time </tui-input-time>
  <div class="flex-wrap tui-form__row">
    <button tuiButton class="tui-form__button right">Сохранить</button>
  </div>
</ng-template>
